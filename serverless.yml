service: github-handyman

frameworkVersion: ">=1.1.0 <2.0.0"

provider:
  name: aws
  stage: ${opt:stage, 'production'}
  runtime: nodejs10.x
  region: ${file(share/terraform/terraform.json):aws_region}
  memorySize: 128
  versionFunctions: false
  role: ${file(share/terraform/terraform.json):aws_iam_role_arn}
  vpc:
    subnetIds: ${file(share/terraform/terraform.json):aws_subnet_ids}
    securityGroupIds: ${file(share/terraform/terraform.json):aws_security_group_ids}
  environment:
    GH_TOKEN: ${env:GH_TOKEN}
    GH_ORGS: ${env:GH_ORGS}
  tracing:
    lambda: true

plugins:
  - serverless-plugin-include-dependencies

package:
  exclude:
    - node_modules/**
    - .serverless/**
    - serverless.yml
    - .git/**
    - .gitignore
    - .idea/**
    - '*.iml'
    - test/**
    - package.json
    - .babelrc
    - .eslintignore
    - .eslintrc
    - README.md
    - src/**
    - coverage/**

functions:
  handler:
    handler: build/index.handler
    events:
      - schedule: rate(30 minutes)
    timeout: 480

resources:
  Resources:
    HandlerLogGroup:
      Type: AWS::Logs::LogGroup
      Properties:
        RetentionInDays: 30
